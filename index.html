<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para mi Ivana ‚ù§Ô∏è</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        #instruccion {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: white; font-size: 0.7rem; opacity: 0.5; z-index: 100; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="instruccion">Gira con un dedo, zoom con dos. Toca para m√∫sica üéµ</div>

    <audio id="musica" loop>
        <source src="cancion.mp3" type="audio/mpeg">
    </audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, starGroup, mainText;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let zoom = 5;

        // Lista de mensajes actualizada
        const mensajesPeque√±os = [
            "Te amo demasiado", "Azul", "Brunito", "18/09/26", "Primera cita en el cine",
            "Coqueta", "Museo", "Besitos", "Barramos el techo", "Has lasa√±a", "My Valentine",
            "Mi esposita", "Mi gatita", "Mi mordelona", "Muerdeme m√°s plis", "Te amo demasiado mi amor",
            "Tengamos otra cita", "Cita", "Cita cita", "Quieres pelear?", "Te amo", "Casemonos",
            "Casemonos", "Casemonos", "Casemonos", "Me encantas beb√©", "Te adoro", "Eres mi vida", 
            "Mi cielito", "I found you", "Mi reina", "Mi amor", "Mi tesoro", "Ivanita", "Mi beb√©", 
            "La madre de mis hijos", "Mi princesa", "Muerdeme", "Eres mi estrella", "Mi solecito", 
            "Mi lindura", "Te amo x100", "Feliz Valent√≠n", "Te extra√±o", "Tu cinturita", "Muak", 
            "Besemonos", "Mi florcita", "Mi maestra", "Eres mi familia ya", "Mi bebecita",
            "Me alegras los d√≠as siempre", "No s√© que har√≠a sin t√≠", "Porfa nunca terminemos",
            "Tengamos muchos animalitos", "Mi preciosa", "Beautyfull", "Gracias por llegar a mi vida", 
            "Me cambiaste para bien", "obsessive", "Tengamos 1 hijito bello", "Te amo Ivana", 
            "Siempre te proteger√©", "Siempre confiar√© en ti", "Siempre siempre", "Siempre pienso en t√≠", 
            "Me haces muy feliz", "Mi mujer", "Mi esposa", "La que debo proteger", "Quieres mis c√≥rneas?",
            "Mi color favorito", "Mi m√∫sica favorita", "Mi persona favorita", "Mi coraz√≥n"
        ];

        function createTextSprite(text, color, fontSize, isMain = false) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = isMain ? 1024 : 512;
            canvas.height = 256;
            ctx.fillStyle = color;
            ctx.font = `Bold ${fontSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            if(isMain) {
                ctx.shadowColor = 'rgba(0,0,0,1)';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 5;
                ctx.shadowOffsetY = 5;
            }
            
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture, transparent: true });
            const sprite = new THREE.Sprite(material);
            return sprite;
        }

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            starGroup = new THREE.Group();
            scene.add(starGroup);

            // 1. GALAXIA ROSA SUAVE (Cherry Blossom)
            const starGeo = new THREE.BufferGeometry();
            const starCount = 15000;
            const posArray = new Float32Array(starCount * 3);
            for(let i=0; i < starCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 40;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            // Color cambiado a Rosa Suave (0xff69b4)
            const starMat = new THREE.PointsMaterial({ size: 0.025, color: 0xff69b4, transparent: true, opacity: 0.8 });
            const stars = new THREE.Points(starGeo, starMat);
            starGroup.add(stars);

            // 2. MENSAJE PRINCIPAL ROJO (CAPA 3D)
            mainText = createTextSprite("Te amo mucho Ivana ‚ù§Ô∏è", "#ff0000", 90, true);
            mainText.scale.set(6, 1.5, 1);
            mainText.position.set(0, 0, 0.5);
            scene.add(mainText);

            // 3. MENSAJITOS PEQUE√ëOS EN EL ESPACIO
            mensajesPeque√±os.forEach(t => {
                const s = createTextSprite(t, "rgba(255, 255, 255, 0.9)", 35);
                s.position.set((Math.random()-0.5)*30, (Math.random()-0.5)*30, (Math.random()-0.5)*30);
                s.scale.set(1.8, 0.45, 1);
                starGroup.add(s);
            });

            camera.position.z = zoom;

            const startAction = (x, y) => {
                isDragging = true;
                previousMousePosition = { x, y };
                document.getElementById('musica').play().catch(()=>{});
                document.getElementById('instruccion').style.display = 'none';
            };

            const moveAction = (x, y) => {
                if (isDragging) {
                    starGroup.rotation.y += (x - previousMousePosition.x) * 0.005;
                    starGroup.rotation.x += (y - previousMousePosition.y) * 0.005;
                    mainText.position.x += (x - previousMousePosition.x) * 0.002;
                    mainText.position.y -= (y - previousMousePosition.y) * 0.002;
                    previousMousePosition = { x, y };
                }
            };

            window.addEventListener('mousedown', e => startAction(e.clientX, e.clientY));
            window.addEventListener('mousemove', e => moveAction(e.clientX, e.clientY));
            window.addEventListener('mouseup', () => {
                isDragging = false;
                mainText.position.set(0,0,0.5);
            });
            
            let initialDist = 0;
            window.addEventListener('touchstart', e => {
                if(e.touches.length === 1) startAction(e.touches[0].clientX, e.touches[0].clientY);
            });
            window.addEventListener('touchmove', e => {
                if(e.touches.length === 2) {
                    let dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                    if(initialDist > 0) {
                        zoom += (initialDist - dist) * 0.02;
                        zoom = Math.max(1, Math.min(30, zoom));
                        camera.position.z = zoom;
                    }
                    initialDist = dist;
                } else {
                    moveAction(e.touches[0].clientX, e.touches[0].clientY);
                }
            });
            window.addEventListener('touchend', () => { isDragging = false; initialDist = 0; mainText.position.set(0,0,0.5); });

            window.addEventListener('wheel', e => {
                zoom += e.deltaY * 0.01;
                zoom = Math.max(1, Math.min(30, zoom));
                camera.position.z = zoom;
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            if(!isDragging) {
                starGroup.rotation.y += 0.001;
                mainText.position.y = Math.sin(Date.now() * 0.002) * 0.1;
            }
            renderer.render(scene, camera);
        }

        init();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
