<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para mi Ivana Eterna ‚ù§Ô∏è</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        #instruccion {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: white; font-size: 0.7rem; opacity: 0.5; z-index: 100; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="instruccion">Usa un dedo para girar y dos para zoom. Toca para m√∫sica üéµ</div>

    <audio id="musica" loop>
        <source src="cancion.mp3" type="audio/mpeg">
    </audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, starGroup, mainTextGroup;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let zoom = 6;

        const mensajesPeque√±os = [
            "Me encantas beb√©", "Te adoro", "Eres mi vida", "Mi cielito", "I found you", "Mi reina",
            "Casemonos", "Coqueta", "Mi amor", "Mi tesoro", "Ivanita", "Mi beb√©", "La madre de mis hijos",
            "Mi princesa", "Muerdeme", "Eres mi estrella", "Mi solecito", "Mi lindura", "Te amo x100",
            "Feliz Valent√≠n", "Te extra√±o", "Tu cinturita", "Muak", "Besemonos", "Te amo", "Mi florcita",
            "Mi maestra", "Mi coqueta", "Eres mi familia ya", "Te extra√±o", "Mi Reyna", "Mi bebecita",
            "La beb√©", "Me alegras los d√≠as siempre", "No s√© que har√≠a sin t√≠", "Porfa nunca terminemos",
            "Tengamos muchos animalitos", "Mi preciosa", "Beautyfull", "Gracias", "Muchas gracias",
            "Gracias por llegar a mi vida", "Me cambiaste para bien", "obsessive", "Te amo",
            "Tengamos 1 hijito bello", "Plis", "Mi princesitaaa", "Te amo Ivana", "Siempre te proteger√©",
            "Siempre confiar√© en ti", "Siempre siempre", "Siempre pienso en t√≠", "Me haces muy feliz",
            "Mi mujer", "Mi esposa", "Mi marida", "La que debo proteger", "Quieres mis c√≥rneas?",
            "Mi color favorito", "Mi m√∫sica favorita", "Mi olor favorito", "Mi persona favorita", "Mi coraz√≥n"
        ];

        function createTextSprite(text, color, fontSize = 24) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            ctx.fillStyle = color;
            ctx.font = `Bold ${fontSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText(text, 256, 64);
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture, transparent: true });
            const sprite = new THREE.Sprite(material);
            return sprite;
        }

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            starGroup = new THREE.Group();
            scene.add(starGroup);

            // 1. GALAXIA AZUL 3D
            const starGeo = new THREE.BufferGeometry();
            const starCount = 15000;
            const posArray = new Float32Array(starCount * 3);
            for(let i=0; i < starCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 25;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const starMat = new THREE.PointsMaterial({ size: 0.02, color: 0x00d9ff, transparent: true, opacity: 0.7 });
            const stars = new THREE.Points(starGeo, starMat);
            starGroup.add(stars);

            // 2. MENSAJE PRINCIPAL 3D (ROJO)
            // Lo ponemos en el centro, pero como objeto 3D que gira
            const mainText = createTextSprite("Te amo mucho Ivana, eres el amor de mi vida ‚ù§Ô∏è", "#ff0000", 32);
            mainText.scale.set(6, 1.5, 1);
            mainText.position.set(0, 0, 0);
            scene.add(mainText); // Este se queda fijo o puedes meterlo a starGroup para que gire

            // 3. LLUVIA DE MENSAJITOS 3D
            mensajesPeque√±os.forEach(t => {
                const s = createTextSprite(t, "rgba(255, 255, 255, 0.8)", 20);
                s.position.set((Math.random()-0.5)*15, (Math.random()-0.5)*15, (Math.random()-0.5)*15);
                s.scale.set(2, 0.5, 1);
                starGroup.add(s);
            });

            camera.position.z = zoom;

            // --- INTERACCI√ìN ---
            const startAction = (x, y) => {
                isDragging = true;
                previousMousePosition = { x, y };
                document.getElementById('musica').play().catch(()=>{});
                document.getElementById('instruccion').style.display = 'none';
            };

            const moveAction = (x, y) => {
                if (isDragging) {
                    starGroup.rotation.y += (x - previousMousePosition.x) * 0.005;
                    starGroup.rotation.x += (y - previousMousePosition.y) * 0.005;
                    previousMousePosition = { x, y };
                }
            };

            // Eventos Mouse y Touch
            window.addEventListener('mousedown', e => startAction(e.clientX, e.clientY));
            window.addEventListener('mousemove', e => moveAction(e.clientX, e.clientY));
            window.addEventListener('mouseup', () => isDragging = false);
            
            let initialDist = 0;
            window.addEventListener('touchstart', e => {
                if(e.touches.length === 1) startAction(e.touches[0].clientX, e.touches[0].clientY);
            });
            window.addEventListener('touchmove', e => {
                if(e.touches.length === 2) {
                    let dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                    if(initialDist > 0) {
                        zoom += (initialDist - dist) * 0.01;
                        zoom = Math.max(1, Math.min(20, zoom));
                        camera.position.z = zoom;
                    }
                    initialDist = dist;
                } else {
                    moveAction(e.touches[0].clientX, e.touches[0].clientY);
                }
            });
            window.addEventListener('touchend', () => { isDragging = false; initialDist = 0; });

            // Zoom Mouse
            window.addEventListener('wheel', e => {
                zoom += e.deltaY * 0.005;
                zoom = Math.max(1, Math.min(20, zoom));
                camera.position.z = zoom;
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            if(!isDragging) {
                starGroup.rotation.y += 0.0008;
            }
            renderer.render(scene, camera);
        }

        init();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
