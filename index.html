<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para mi Ivana ‚ù§Ô∏è</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; }
        #instruccion {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: white; font-size: 0.7rem; opacity: 0.5; z-index: 100; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="instruccion">Gira con un dedo, zoom con dos. Toca para m√∫sica üéµ</div>

    <audio id="musica" loop>
        <source src="cancion.mp3" type="audio/mpeg">
    </audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, starGroup, mainText;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let zoom = 8; // Zoom un poco m√°s alejado para apreciar la esfera central

        const mensajesPeque√±os = [
            "Me encantas beb√©", "Te adoro", "Eres mi vida", "Mi cielito", "I found you", "Mi reina",
            "Casemonos", "Coqueta", "Mi amor", "Mi tesoro", "Ivanita", "Mi beb√©", "La madre de mis hijos",
            "Mi princesa", "Muerdeme", "Eres mi estrella", "Mi solecito", "Mi lindura", "Te amo x100",
            "Feliz Valent√≠n", "Te extra√±o", "Tu cinturita", "Muak", "Besemonos", "Te amo", "Mi florcita",
            "Mi maestra", "Mi coqueta", "Eres mi familia ya", "Te extra√±o", "Mi Reyna", "Mi bebecita",
            "La beb√©", "Me alegras los d√≠as siempre", "No s√© que har√≠a sin t√≠", "Porfa nunca terminemos",
            "Tengamos muchos animalitos", "Mi preciosa", "Beautyfull", "Gracias", "Muchas gracias",
            "Gracias por llegar a mi vida", "Me cambiaste para bien", "obsessive", "Te amo",
            "Tengamos 1 hijito bello", "Plis", "Mi princesitaaa", "Te amo Ivana", "Siempre te proteger√©",
            "Siempre confiar√© en ti", "Siempre siempre", "Siempre pienso en t√≠", "Me haces muy feliz",
            "Mi mujer", "Mi esposa", "Mi marida", "La que debo proteger", "Quieres mis c√≥rneas?",
            "Mi color favorito", "Mi m√∫sica favorita", "Mi olor favorito", "Mi persona favorita", "Mi coraz√≥n"
        ];

        function createTextSprite(text, color, fontSize, isMain = false) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = isMain ? 1024 : 512;
            canvas.height = 256;
            ctx.fillStyle = color;
            ctx.font = `Bold ${fontSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            if(isMain) {
                ctx.shadowColor = color;
                ctx.shadowBlur = 20;
            }
            
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture, transparent: true });
            const sprite = new THREE.Sprite(material);
            return sprite;
        }

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            starGroup = new THREE.Group();
            scene.add(starGroup);

            // --- EFECTO DE ESFERA CENTRAL Y DISPERSI√ìN ---
            const starGeo = new THREE.BufferGeometry();
            const starCount = 15000;
            const posArray = new Float32Array(starCount * 3);

            for(let i=0; i < starCount; i++) {
                // El truco est√° en usar Math.pow para concentrar los valores cerca del 0
                const dist = Math.pow(Math.random(), 3) * 35; 
                
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);

                posArray[i*3] = dist * Math.sin(phi) * Math.cos(theta);
                posArray[i*3+1] = dist * Math.sin(phi) * Math.sin(theta);
                posArray[i*3+2] = dist * Math.cos(phi);
            }

            starGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const starMat = new THREE.PointsMaterial({ 
                size: 0.035, 
                color: 0x00d9ff, 
                transparent: true, 
                opacity: 0.9 
            });
            const stars = new THREE.Points(starGeo, starMat);
            starGroup.add(stars);

            // 2. MENSAJE PRINCIPAL ROJO
            mainText = createTextSprite("Te amo mucho Ivana ‚ù§Ô∏è", "#ff0000", 90, true);
            mainText.scale.set(6, 1.5, 1);
            mainText.position.set(0, 0, 1.5); // Ligeramente frente al n√∫cleo
            scene.add(mainText);

            // 3. MENSAJITOS PEQUE√ëOS EN EL ESPACIO
            mensajesPeque√±os.forEach(t => {
                const s = createTextSprite(t, "rgba(255, 255, 255, 0.85)", 35);
                // Estos se dispersan de forma m√°s uniforme para que se puedan leer al navegar
                s.position.set((Math.random()-0.5)*30, (Math.random()-0.5)*30, (Math.random()-0.5)*30);
                s.scale.set(1.8, 0.45, 1);
                starGroup.add(s);
            });

            camera.position.z = zoom;

            // --- INTERACCI√ìN ---
            const startAction = (x, y) => {
                isDragging = true;
                previousMousePosition = { x, y };
                document.getElementById('musica').play().catch(()=>{});
                document.getElementById('instruccion').style.display = 'none';
            };

            const moveAction = (x, y) => {
                if (isDragging) {
                    starGroup.rotation.y += (x - previousMousePosition.x) * 0.005;
                    starGroup.rotation.x += (y - previousMousePosition.y) * 0.005;
                    previousMousePosition = { x, y };
                }
            };

            window.addEventListener('mousedown', e => startAction(e.clientX, e.clientY));
            window.addEventListener('mousemove', e => moveAction(e.clientX, e.clientY));
            window.addEventListener('mouseup', () => isDragging = false);
            
            window.addEventListener('touchstart', e => {
                if(e.touches.length === 1) startAction(e.touches[0].clientX, e.touches[0].clientY);
            });
            window.addEventListener('touchmove', e => {
                if(e.touches.length === 2) {
                    let dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                    zoom = Math.max(2, Math.min(45, zoom + (dist < 100 ? 0.1 : -0.1)));
                    camera.position.z = zoom;
                } else {
                    moveAction(e.touches[0].clientX, e.touches[0].clientY);
                }
            });
            window.addEventListener('touchend', () => { isDragging = false; });

            window.addEventListener('wheel', e => {
                zoom = Math.max(2, Math.min(45, zoom + e.deltaY * 0.01));
                camera.position.z = zoom;
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            if(!isDragging) {
                starGroup.rotation.y += 0.001;
            }
            renderer.render(scene, camera);
        }

        init();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
